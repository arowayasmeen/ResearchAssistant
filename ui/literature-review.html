<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ResearchAssistant - Literature Review</title>
    <link rel="stylesheet" href="css/lit.css">
    
</head>
<div class="sidebar">
    <div class="sidebar-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
        </svg>
        <span class="tooltip">Home</span>
    </div>
    <div class="sidebar-icon">
        <img src="images/spyglass.png" alt="spyglass" class="icon-image">
        <span class="tooltip">Literature Review</span>
    </div> 
    <div class="sidebar-icon">
        <img src="images/helm.png" alt="helm" class="icon-image">
        <span class="tooltip">Generate Ideas</span>
    </div>
    <div class="sidebar-icon">
        <img src="images/quill.png" alt="quill" class="icon-image">
        <span class="tooltip">Prepare a Draft</span>
    </div>
</div>
    <div class="main-content">
        <h1 class="logo">ResearchAssistant</h1>

        <div class="topic-header">
            <div class="topic-name">Topic Name</div>
            <div class="topic-suffix">Literature Review</div>
        </div>
        
        <div class="research-section">
            <div class="section-title">Research Topic</div>
            <textarea class="research-textarea" placeholder="Briefly describe the research topic that you want to search relevant papers for ....."></textarea>
        </div>
        
        <div class="search-engines">            
            <button class="search-button">Search</button>
        </div>

        <div id="results-container" style="margin-top: 30px; display: none;">
            <div class="results-table">
                <table style="width: 100%; border-collapse: collapse; border-radius: 10px; overflow: hidden;">
                    <thead>
                        <tr style="background-color: #f2e8d8; border-bottom: 1px solid #e0c8a0;">
                            <th style="padding: 15px; text-align: left; width: 30%;">Title</th>
                            <th style="padding: 15px; text-align: left; width: 20%;">Authors</th>
                            <th style="padding: 15px; text-align: center; width: 8%;">Year</th>
                            <th style="padding: 15px; text-align: left; width: 15%;">Venue</th>
                            <th style="padding: 15px; text-align: center; width: 12%;">Relevance</th>
                            <th style="padding: 15px; text-align: left; width: 15%;">Link</th>
                        </tr>
                    </thead>
                    <tbody id="results-body">
                        <!-- Results will be populated here -->
                    </tbody>
                </table>
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button id="export-button" class="export-button">Export Results</button>
                <div id="export-options" class="export-options">
                    <button id="export-csv" class="export-button" style="margin-right: 10px;">CSV</button>
                    <button id="export-json" class="export-button">JSON</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get the topic name from localStorage
            const topicName = localStorage.getItem('topicName') || 'Literature Review';
            
            // Set the topic name in the header
            document.querySelector('.topic-name').textContent = topicName;

            // Reference to UI elements
            const researchTopicTextarea = document.querySelector('.research-textarea');
            const searchButton = document.querySelector('.search-button');
            const resultsContainer = document.getElementById('results-container');
            const resultsBody = document.getElementById('results-body');
            const exportButton = document.getElementById('export-button');
            const exportOptions = document.getElementById('export-options');
            const exportCSV = document.getElementById('export-csv');
            const exportJSON = document.getElementById('export-json');

            // Variable to store the current results
            let currentResults = [];
            
            // Add functionality to search button
            searchButton.addEventListener('click', function() {
                // Add search functionality here
                const query = researchTopicTextarea.value.trim();
                
                if (!query) {
                    alert('Please enter a research topic');
                    return;
                }
                
                // Show loading state
                resultsContainer.style.display = 'block';
                resultsBody.innerHTML = '<tr><td colspan="6" class="loading">Searching for papers...</td></tr>';
                
                // Call the backend API to search for papers
                searchForPapers(query);
            });
            
            // Function to search for papers (makes actual API calls)
            function searchForPapers(query) {
                // Show loading state
                resultsContainer.style.display = 'block';
                resultsBody.innerHTML = '<tr><td colspan="6" class="loading">Searching for papers...</td></tr>';
                
                // In a production environment, this would be the URL of your deployed backend
                const apiUrl = 'http://localhost:5000/api/search';
                fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        query: query
                    }),
                })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(errorData => {
                            throw new Error(`Server error: ${errorData.error || response.statusText}`);
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    currentResults = data.results;
                    displayResults(data.results);
                })
                .catch(error => {
                    console.error('Error searching for papers:', error);

                    // Display the error in the UI
                    resultsBody.innerHTML = `<tr><td colspan="6" class="loading" style="color: #F44336;">
                        Error: ${error.message}. Using backup data instead.</td></tr>`;
        
                    
                    // If there's an error with the API call, use backup data for demonstration
                    setTimeout(() => {
                        const backupResults = getBackupResults(query);
                        currentResults = backupResults;
                        displayResults(backupResults);
                    }, 2000);
                });
            }
            
            // Backup function to get results in case the API call fails
            function getBackupResults(query) {
                return [
                    { 
                        title: `${query}: Advancements in neural networks and transfer learning approaches`,
                        authors: "Smith J., Johnson M.",
                        year: "2023",
                        venue: "Journal of AI Research",
                        score: 95,
                        link: `https://scholar.google.com/scholar?q=${encodeURIComponent(query)}`
                    },
                    { 
                        title: `Current state and future perspectives of ${query}`,
                        authors: "Williams A., Brown R.",
                        year: "2022",
                        venue: "IEEE Transactions",
                        score: 87,
                        link: `https://scholar.google.com/scholar?q=${encodeURIComponent(query)}+review`
                    },
                    { 
                        title: `Meta-analysis of ${query} methodologies: A systematic review`,
                        authors: "Garcia L., et al.",
                        year: "2021",
                        venue: "arXiv",
                        score: 82,
                        link: `https://scholar.google.com/scholar?q=${encodeURIComponent(query)}+meta+analysis`
                    },
                    { 
                        title: `Experimental evaluation of ${query} systems`,
                        authors: "Chen P., Wang Y.",
                        year: "2020",
                        venue: "Conference on Computer Vision",
                        score: 72,
                        link: `https://scholar.google.com/scholar?q=${encodeURIComponent(query)}+experimental`
                    },
                    { 
                        title: `${query} in real-world applications: A case study`,
                        authors: "Kim H., Lee S.",
                        year: "2021",
                        venue: "Applied Sciences",
                        score: 65,
                        link: `https://scholar.google.com/scholar?q=${encodeURIComponent(query)}+case+study`
                    }
                ];
            }
            
            // Function to display results in the table
            function displayResults(results) {
                resultsBody.innerHTML = '';
                
                if (!results || results.length === 0) {
                    resultsBody.innerHTML = '<tr><td colspan="6" class="loading">No results found</td></tr>';
                    return;
                }
                
                results.forEach(paper => {
                    const row = document.createElement('tr');
                    
                    // Create relevance score display with color coding
                    const scoreColor = getScoreColor(paper.score);
                    const scoreDisplay = `<div class="relevance-badge" style="background-color: ${scoreColor};">${paper.score}%</div>`;
                    
                    row.innerHTML = `
                        <td>${paper.title}</td>
                        <td>${paper.authors || 'N/A'}</td>
                        <td style="text-align: center;">${paper.year || 'N/A'}</td>
                        <td>${paper.venue || 'N/A'}</td>
                        <td style="text-align: center;">${scoreDisplay}</td>
                        <td><a href="${paper.link}" class="paper-link" target="_blank">View Paper</a></td>
                    `;
                    resultsBody.appendChild(row);
                });
            }
            
            // Function to get color based on score
            function getScoreColor(score) {
                if (score >= 90) return '#4CAF50'; // Green
                if (score >= 75) return '#2196F3'; // Blue
                if (score >= 60) return '#FF9800'; // Orange
                return '#F44336'; // Red
            }
            
            // Export button functionality
            exportButton.addEventListener('click', function() {
                if (exportOptions.style.display === 'block') {
                    exportOptions.style.display = 'none';
                } else {
                    exportOptions.style.display = 'block';
                }
            });
            
            // Export to CSV
            exportCSV.addEventListener('click', function() {
                if (currentResults.length === 0) {
                    alert('No results to export');
                    return;
                }
                
                let csvContent = "data:text/csv;charset=utf-8,";
                
                // Add headers
                csvContent += "Title,Authors,Year,Venue,Relevance Score,Link\n";
                
                // Add rows
                currentResults.forEach(paper => {
                    csvContent += `"${paper.title}","${paper.authors || ''}","${paper.year || ''}","${paper.venue || ''}","${paper.score}","${paper.link}"\n`;
                });
                
                // Create download link
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "research_papers.csv");
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                exportOptions.style.display = 'none';
            });
            
            // Export to JSON
            exportJSON.addEventListener('click', function() {
                if (currentResults.length === 0) {
                    alert('No results to export');
                    return;
                }
                
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(currentResults, null, 2));
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", "research_papers.json");
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
                
                exportOptions.style.display = 'none';
            });
            
            // Map tooltips (or any identifier) to page URLs
            const pageMap = {
                "Home": "index.html",
                "Literature Review": "literature-review.html",
                "Generate Ideas": "generate-ideas.html",
                "Prepare a Draft": "draft-preparation.html"
            };

            // Select all sidebar icons
            document.querySelectorAll('.sidebar-icon').forEach(icon => {
                const tooltip = icon.querySelector('.tooltip');
                if (tooltip && pageMap[tooltip.textContent]) {
                    icon.addEventListener('click', () => {
                        window.location.href = pageMap[tooltip.textContent];
                    });
                }
            });
        });
    </script>
</body>
</html>